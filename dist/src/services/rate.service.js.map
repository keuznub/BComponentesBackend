{"version":3,"sources":["../../../src/services/rate.service.ts"],"sourcesContent":["import { PrismaClient, Rate  } from \"@prisma/client\"\r\nimport { HttpException } from \"../exceptions/httpException\"\r\nimport {prisma} from 'database/adapter'\r\n\r\nexport class RateService{\r\n    \r\n    static async getAll(){\r\n        const findRates = await prisma.rate.findMany()\r\n        if(!findRates) throw new HttpException(404,\"Rates not found\")\r\n        return findRates\r\n    }\r\n\r\n    static async getByProductId(idProduct: number){\r\n        const findRate = await prisma.rate.findMany({where:{idProduct}})\r\n        if(!findRate) throw new HttpException(404,`Rates of product ${idProduct} not found`)\r\n        return findRate\r\n    }\r\n\r\n    static async getByUserId(idUser: number){\r\n        const findRate = await prisma.rate.findMany({where:{idUser}})\r\n        if(!findRate) throw new HttpException(404,`Rates of user ${idUser} not found`)\r\n        return findRate\r\n    }\r\n\r\n    static async getAvgByProductId(idProduct: number){\r\n        const findRate = await prisma.rate.aggregate({\r\n            where:{idProduct},\r\n            _avg:{value:true},\r\n        })\r\n        if(!findRate) throw new HttpException(404,`Rates of product ${idProduct} not found`)\r\n        \r\n        return findRate._avg\r\n    }\r\n\r\n    static async getByIds(idUser: number, idProduct:number){\r\n        const findRate = await prisma.rate.findUnique({where:{idUser_idProduct:{idUser,idProduct}}})\r\n        if(!findRate) throw new HttpException(404,`Rate not found`)\r\n        return findRate\r\n    }\r\n\r\n\r\n    static async save(rate: Rate){\r\n\r\n        return await prisma.rate.upsert({\r\n            where:{\r\n                idUser_idProduct:{idUser:rate.idUser,idProduct:rate.idProduct}\r\n            },\r\n            update:{...rate},\r\n            create:{...rate}\r\n        })\r\n    }\r\n\r\n    static async delete(idUser: number, idProduct: number){\r\n        const findRate = await prisma.rate.findUnique({where:{idUser_idProduct:{idUser,idProduct}}})\r\n        if(!findRate) throw new HttpException(404,`Rate not found`)\r\n        return await prisma.rate.delete({where:{idUser_idProduct:{idUser,idProduct}}})\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}"],"names":["HttpException","prisma","RateService","getAll","findRates","rate","findMany","getByProductId","idProduct","findRate","where","getByUserId","idUser","getAvgByProductId","aggregate","_avg","value","getByIds","findUnique","idUser_idProduct","save","upsert","update","create","delete"],"mappings":"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"}