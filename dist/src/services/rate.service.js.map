{"version":3,"sources":["../../../src/services/rate.service.ts"],"sourcesContent":["import { PrismaClient, Rate  } from \"@prisma/client\"\r\nimport { HttpException } from \"../exceptions/httpException\"\r\nimport {prisma} from 'database/adapter'\r\n\r\nexport class RateService{\r\n    \r\n    static async getAll(){\r\n        const findRates = await prisma.rate.findMany()\r\n        if(!findRates) throw new HttpException(404,\"Rates not found\")\r\n        return findRates\r\n    }\r\n\r\n    static async getByProductId(idProduct: number){\r\n        const findRate = await prisma.rate.findMany({where:{idProduct}})\r\n        if(!findRate) throw new HttpException(404,`Rates of product ${idProduct} not found`)\r\n        return findRate\r\n    }\r\n\r\n    static async getByUserId(idUser: number){\r\n        const findRate = await prisma.rate.findMany({where:{idUser}})\r\n        if(!findRate) throw new HttpException(404,`Rates of user ${idUser} not found`)\r\n        return findRate\r\n    }\r\n\r\n    static async getAvgByProductId(idProduct: number){\r\n        const findRate = await prisma.rate.aggregate({\r\n            where:{idProduct},\r\n            _avg:{value:true},\r\n        })\r\n        if(!findRate) throw new HttpException(404,`Rates of product ${idProduct} not found`)\r\n        \r\n        return findRate._avg\r\n    }\r\n\r\n    static async getByIds(idUser: number, idProduct:number){\r\n        const findRate = await prisma.rate.findUnique({where:{idUser_idProduct:{idUser,idProduct}}})\r\n        if(!findRate) throw new HttpException(404,`Rate not found`)\r\n        return findRate\r\n    }\r\n\r\n\r\n    static async save(rate: Rate){\r\n\r\n        return await prisma.rate.upsert({\r\n            where:{\r\n                idUser_idProduct:{idUser:rate.idUser,idProduct:rate.idProduct}\r\n            },\r\n            update:{...rate},\r\n            create:{...rate}\r\n        })\r\n    }\r\n\r\n    static async delete(idUser: number, idProduct: number){\r\n        const findRate = await prisma.rate.findUnique({where:{idUser_idProduct:{idUser,idProduct}}})\r\n        if(!findRate) throw new HttpException(404,`Rate not found`)\r\n        return await prisma.rate.delete({where:{idUser_idProduct:{idUser,idProduct}}})\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}"],"names":["RateService","getAll","findRates","prisma","rate","findMany","HttpException","getByProductId","idProduct","findRate","where","getByUserId","idUser","getAvgByProductId","aggregate","_avg","value","getByIds","findUnique","idUser_idProduct","save","upsert","update","create","delete"],"mappings":";;;;+BAIaA;;;eAAAA;;;+BAHiB;yBACT;AAEd,IAAA,AAAMA,cAAN,MAAMA;IAET,aAAaC,SAAQ;QACjB,MAAMC,YAAY,MAAMC,eAAM,CAACC,IAAI,CAACC,QAAQ;QAC5C,IAAG,CAACH,WAAW,MAAM,IAAII,4BAAa,CAAC,KAAI;QAC3C,OAAOJ;IACX;IAEA,aAAaK,eAAeC,SAAiB,EAAC;QAC1C,MAAMC,WAAW,MAAMN,eAAM,CAACC,IAAI,CAACC,QAAQ,CAAC;YAACK,OAAM;gBAACF;YAAS;QAAC;QAC9D,IAAG,CAACC,UAAU,MAAM,IAAIH,4BAAa,CAAC,KAAI,CAAC,iBAAiB,EAAEE,UAAU,UAAU,CAAC;QACnF,OAAOC;IACX;IAEA,aAAaE,YAAYC,MAAc,EAAC;QACpC,MAAMH,WAAW,MAAMN,eAAM,CAACC,IAAI,CAACC,QAAQ,CAAC;YAACK,OAAM;gBAACE;YAAM;QAAC;QAC3D,IAAG,CAACH,UAAU,MAAM,IAAIH,4BAAa,CAAC,KAAI,CAAC,cAAc,EAAEM,OAAO,UAAU,CAAC;QAC7E,OAAOH;IACX;IAEA,aAAaI,kBAAkBL,SAAiB,EAAC;QAC7C,MAAMC,WAAW,MAAMN,eAAM,CAACC,IAAI,CAACU,SAAS,CAAC;YACzCJ,OAAM;gBAACF;YAAS;YAChBO,MAAK;gBAACC,OAAM;YAAI;QACpB;QACA,IAAG,CAACP,UAAU,MAAM,IAAIH,4BAAa,CAAC,KAAI,CAAC,iBAAiB,EAAEE,UAAU,UAAU,CAAC;QAEnF,OAAOC,SAASM,IAAI;IACxB;IAEA,aAAaE,SAASL,MAAc,EAAEJ,SAAgB,EAAC;QACnD,MAAMC,WAAW,MAAMN,eAAM,CAACC,IAAI,CAACc,UAAU,CAAC;YAACR,OAAM;gBAACS,kBAAiB;oBAACP;oBAAOJ;gBAAS;YAAC;QAAC;QAC1F,IAAG,CAACC,UAAU,MAAM,IAAIH,4BAAa,CAAC,KAAI,CAAC,cAAc,CAAC;QAC1D,OAAOG;IACX;IAGA,aAAaW,KAAKhB,IAAU,EAAC;QAEzB,OAAO,MAAMD,eAAM,CAACC,IAAI,CAACiB,MAAM,CAAC;YAC5BX,OAAM;gBACFS,kBAAiB;oBAACP,QAAOR,KAAKQ,MAAM;oBAACJ,WAAUJ,KAAKI,SAAS;gBAAA;YACjE;YACAc,QAAO;gBAAC,GAAGlB,IAAI;YAAA;YACfmB,QAAO;gBAAC,GAAGnB,IAAI;YAAA;QACnB;IACJ;IAEA,aAAaoB,OAAOZ,MAAc,EAAEJ,SAAiB,EAAC;QAClD,MAAMC,WAAW,MAAMN,eAAM,CAACC,IAAI,CAACc,UAAU,CAAC;YAACR,OAAM;gBAACS,kBAAiB;oBAACP;oBAAOJ;gBAAS;YAAC;QAAC;QAC1F,IAAG,CAACC,UAAU,MAAM,IAAIH,4BAAa,CAAC,KAAI,CAAC,cAAc,CAAC;QAC1D,OAAO,MAAMH,eAAM,CAACC,IAAI,CAACoB,MAAM,CAAC;YAACd,OAAM;gBAACS,kBAAiB;oBAACP;oBAAOJ;gBAAS;YAAC;QAAC;IAChF;AAMJ"}